<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>#Path Tracer</p>
<p>Tom Minor, Bournemouth, NCCA</p>
<h2>Summary</h2>
<p>My original goals for this project were to create a path tracer with Open Shading Language integration, possibly using Photon Mapping as an optimisation technique. However, it's current state is simply a global illumination renderer that supports:</p>
<ul>
<li>Loading primitive/material data from simple text files.</li>
<li>Global Illumination approximation in the scene, light is sampled from any primitive using an emissive material type.</li>
<li>Controlling the sample rate and render size from the user interface.</li>
</ul>
<p>Once the renderer is more mature I hope to carry out my original plans of a usable path tracer integrated with OSL.</p>
<div class="image">
<img src="examples/example.png?raw=true"  alt="Example Render" title="Example"/>
</div>
<h2>Usage</h2>
<h3>3D Viewport</h3>
<p>Displays a real time visualisation of the scene, the camera perspective of this view is used in the final render. Automatically updates when a loaded scene file is changed.</p>
<ul>
<li>**Left Mouse Button + Drag -** Orbit around the viewport.</li>
<li>**Right Mouse Button + Drag -** Pan around the viewport</li>
<li>**Scroll wheel -** Zoom in/out.</li>
<li>**File Menu-** Open scene files.</li>
</ul>
<h3>Render Settings</h3>
<p>Control various aspects of the render output.</p>
<ul>
<li>**Samples -** The amount of samples per pixel, higher values will result in longer render times but more accurate images.</li>
<li>**Output Size -** The resolution of the rendered image.</li>
<li><b>File Name -** The output file name *(only **.ppm</b> files are supported)*</li>
<li>**Render Button -** Render the scene to the file. <em>Note - This will render in the background, right now the progress is only printed to standard output and there is no indication in the UI when the render is complete</em></li>
</ul>
<h3>Scene files</h3>
<p>All scene data is stored in simple text files, empty/commented lines are ignored.</p>
<p>Comments begin with #.</p>
<h4>Data Types</h4>
<ul>
<li><p class="startli"><b>Primitives</b></p>
<p class="startli">Translation XYZ = <code>tx ty tz</code><br />
 Rotation XYZ = <code>rx ry rz</code><br />
 Scale XYZ = <code>sx sy sz</code><br />
 Colour RGB = <code>cr cg cb</code><br />
 Vertex XYZ = <code>vx vy vz</code><br />
</p><ul>
<li><b>Sphere</b> <code>$sphere tx ty tz sx sy sz rx ry rz cr cg cb</code></li>
<li><b>Triangle</b> <code>$tri v0x v0y v0z v1x v1y v1z v2x v2y v2z tx ty tz sx sy sz rx ry rz cr cg cb</code></li>
<li><b>Plane</b> <em>Will be supported in future versions, right now two triangle primitives are used</em></li>
</ul>
</li>
<li><b>Camera</b> <code>$camera tx ty tz sx sy sz rx ry rz fov nearz far z</code></li>
<li><b>Background</b> <code>$background cr cg cb</code></li>
</ul>
<h2>Algorithms/Mathematical Methods</h2>
<h3>Tracing the world</h3>
<p>Proved to me how handy matrices are for storing transformations.</p>
<ol type="1">
<li>Create ray in world space from camera into scene.</li>
<li>Convert into object space for intersection.</li>
<li>Convert impact point and light sample point to world space to calculate new direction vector.</li>
<li>Convert shadow ray to object space for each intersection.</li>
</ol>
<h3>Global Illumination</h3>
<p>``` repeat for many samples per pixel fire a single ray into the scene for each light source in scene if not shaded colour += object colour ```</p><ul>
<li>Sum all light sources.</li>
<li>Only lose energy whenever a ray bounces.</li>
<li>Use inverse square rule to create light falloff.</li>
<li>Use tonemapping to scale luminance<ul>
<li>Gamma correct the image</li>
</ul>
</li>
</ul>
<h3>Refraction</h3>
<p>I didn't get chance to look into these in much detail, but I began trying to implement them for the (unfinished) refraction aspect of the path tracing engine.</p>
<ul>
<li>Schlick's approximation</li>
<li>Snell's law</li>
</ul>
<h2>Known Problems</h2>
<ul>
<li>Due to the use of popping off the token stack in the file reading implementation, the tokens are read in the wrong order for some values. Not a huge problem as the input can be inverted, XYZ becomes ZYX for example. All the more reason to use a well established format.</li>
<li>Depth refuses to work correctly, right now primitives are simply drawn in the order they are read from the file. Using the intersection t value and the world space distance has failed, presumably related to coordinate spaces when calculating intersections.</li>
<li>Spheres are rendered almost fully black, yet shadow rays work correctly and there is a small amount of light hitting the object.</li>
<li>Reflection is roughly implemented, but there are strange artifacts on the triangle reflections and sphere reflections don't seem to exist at all. Refraction doesn't work at all.</li>
<li>No BSDF/BRDF's implemented, only the diffuse colour and global illumination.</li>
</ul>
<h2>Implementation Challenges</h2>
<ul>
<li>Understanding when to convert between object and world space produced many time consuming bugs, some still aren't fixed.</li>
<li>Unsure where parts of classes such as Scene, Camera &amp; RenderContext should go, for example scene will always need at least one camera (and for rendering only one camera will be needed), but logically the render camera is a separate object.</li>
<li>Updating the GUI while rendering seemed to require a fairly complex threading setup that wasn't worth the time to implement, although adding a background render thread for the render process was fairly easy.</li>
</ul>
<h2>Planned Features / Improvements</h2>
<ul>
<li>Acceleration structures such as KD-Trees for faster triangle intersection, other structures for faster object testing.</li>
<li>Open Shading Language to handle surface properties.</li>
<li>Photon mapping to improve the render speed and image quality.</li>
<li>Multi-threaded rendering.</li>
<li>Real-time visualisation in the viewport by rendering in a background thread that updates a framebuffer object.</li>
</ul>
<h2>Design Decisions</h2>
<ul>
<li>Tried to make path tracer separate from visualisation, for example all NGL math classes could be replaced with <em>glm</em> or <em>oiio</em> fairly painlessly. Ideally the renderer should be a standalone program that the interface controls with command line arguments.</li>
<li>Debugging was a challenge, it was difficult to set breakpoints for certain conditions since so many pixels/rays are evaluated. Other raytracing projects seemed to implement a special class that would print debug info and allow for breakpoints under very specific conditions, this seems to be a good approach to ease further development.</li>
<li>The file structure is fairly robust for such a simple filetype, if corrupt data is found then it is simply skipped and an error message is emitted. However, it is tedious to extend for new types of data/primitives and doesn't allow for more advanced concepts such as relative transformations/parenting. I would have liked to look at the RIB format instead, but I decided to focus on the path tracing aspect of the project. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
